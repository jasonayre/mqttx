{"code":"!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define([],e):\"object\"==typeof exports?exports.mqttx=e():t.mqttx=e()}(this,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"\",n(n.s=7)}([function(t,e){t.exports=require(\"lodash\")},function(t,e,n){\"use strict\";n.d(e,\"a\",function(){return r});class r{static serialize(t){return JSON.stringify(t)}static parse(t){return JSON.parse(t.toString())}}},function(t,e,n){\"use strict\";n.d(e,\"a\",function(){return o});var r=n(0),i=n(1);class o{static matchesTopic(t,e){return t===e}constructor({perform:t,topic:e,is_one_time:n=!1,observable:i,onBeforeDispose:o=[]}={}){Object(r.assign)(this,{_perform:t,topic:e,is_one_time:n,observable:i,is_disposed:!1,_onBeforeDisposeCallbacks:o})}matchesTopic(t){return this.constructor.matchesTopic(t,this.topic)}perform(t,e,n){this.matchesTopic(e)&&(this._perform(i.a.parse(t),e,n,this),this.is_one_time&&this.dispose())}dispose(){Object(r.some)(this._onBeforeDisposeCallbacks)&&Object(r.invokeMap)(this._onBeforeDisposeCallbacks,\"call\"),this.observable&&(this.observable.unsubscribe(this),this.observable=null),this.is_disposed=!0}}},function(t,e,n){\"use strict\";function r(t){return new Promise(e=>setTimeout(e,t))}function i({max_attempts:t=5,resolve:e,reject:n,interval:o,condition:s,onInterval:u,returnValue:c=(()=>!0)}){!function(t=1e3,e=(()=>{})){r(t).then(()=>{e()})}(o,()=>{s()?e(c()):(u(),--t<1&&n(\"max_attempts_threshold_reached\"),i({condition:s,interval:o,onInterval:u,resolve:e,returnValue:c}))})}function o({condition:t=(()=>!0),interval:e=100,max_attempts:n=5,onInterval:r=(()=>{}),returnValue:o=(()=>!0)}={}){return new Promise((s,u)=>{i({resolve:s,condition:t,interval:e,max_attempts:n,onInterval:r,returnValue:o,reject:u})})}n.r(e),n.d(e,\"sleep\",function(){return r}),n.d(e,\"waitUntilCondition\",function(){return o})},function(t,e){t.exports=require(\"mqtt\")},function(t,e,n){\"use strict\";(function(t){n.d(e,\"a\",function(){return a});var r=n(0),i=n(4),o=n.n(i),s=n(6),u=n(3),c=n(1);void 0!==t&&\"node\"===Object(r.get)(t,\"release.name\")&&(n(4),console.log(\"after requiring mqtt\"));class a{static connect(...t){this.mqtt=o.a,this.client=o.a.connect(...t),this.subscription_manager=new s.a(this)}static on(t,e=(t=>{console.log(t)}),{qos:n=1,retain:r=!1,...i}={}){let o=this.subscription_manager.subscribe(t,e,{...i});return this.client.subscribe(t,e,{qos:n,...i}),o}static publish(t,e,{as_json:n=!0,qos:r=1,...i}={}){this.client.publish(t,c.a.serialize(e),{qos:r,...i})}static async request(t,e={},{publish_params:n={},qos:r=1,retain:i=!1,interval:o=50,max_attempts:s=5,is_one_time:c=!0,...a}={}){let l,f=`${t}/response`,p=`${t}/request`;let h=this.on(f,t=>l=t,{qos:r,retain:i,is_one_time:c,...a});return this.publish(p,e,{...n}),await Object(u.waitUntilCondition)({condition:()=>h.is_disposed,returnValue:()=>l})}static async respondsTo(t,e=(()=>{}),{publish_params:n={},qos:r=1,retain:i=!1,interval:o=50,max_attempts:s=5,...u}={}){let c=`${t}/response`,a=`${t}/request`;return this.on(a,t=>{let r=e(t);this.publish(c,r,n)},{qos:r,retain:i,...u})}static clear(){this.subscription_manager.clear()}}}).call(this,n(8))},function(t,e,n){\"use strict\";n.d(e,\"a\",function(){return o});var r=n(0),i=n(2);class o{constructor(t){this.subscriptions=[],this.mqttx=t,this._initializeMainSubscription()}_initializeMainSubscription(){this.mqttx.client.on(\"message\",(t,e,n)=>{this.notifySubscriptions(e,t,n)})}subscribe(t,e=(()=>{}),{is_one_time:n=!1,onBeforeDispose:r}={}){let o=new i.a({perform:e,topic:t,is_one_time:n,observable:this,onBeforeDispose:r});return this.subscriptions.push(o),o}unsubscribe(t){this.mqttx.client.unsubscribe(t.topic),this.subscriptions=this.subscriptions.filter(e=>e!==t)}notifySubscriptions(t,e,n){let i=[...this.subscriptions];Object(r.invokeMap)(i,\"perform\",t,e,n)}clear(){let t=[...this.subscriptions];Object(r.invokeMap)(t,\"dispose\")}}},function(t,e,n){\"use strict\";n.r(e);var r=n(5);n.d(e,\"MQTTX\",function(){return r.a});var i=n(3);n.d(e,\"Helpers\",function(){return i});var o=n(2);n.d(e,\"Subscription\",function(){return o.a});var s=n(1);n.d(e,\"Serialization\",function(){return s.a})},function(t,e){var n,r,i=t.exports={};function o(){throw new Error(\"setTimeout has not been defined\")}function s(){throw new Error(\"clearTimeout has not been defined\")}function u(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n=\"function\"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r=\"function\"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var c,a=[],l=!1,f=-1;function p(){l&&c&&(l=!1,c.length?a=c.concat(a):f=-1,a.length&&h())}function h(){if(!l){var t=u(p);l=!0;for(var e=a.length;e;){for(c=a,a=[];++f<e;)c&&c[f].run();f=-1,e=a.length}c=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function m(t,e){this.fun=t,this.array=e}function b(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];a.push(new m(t,e)),1!==a.length||l||u(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title=\"browser\",i.browser=!0,i.env={},i.argv=[],i.version=\"\",i.versions={},i.on=b,i.addListener=b,i.once=b,i.off=b,i.removeListener=b,i.removeAllListeners=b,i.emit=b,i.prependListener=b,i.prependOnceListener=b,i.listeners=function(t){return[]},i.binding=function(t){throw new Error(\"process.binding is not supported\")},i.cwd=function(){return\"/\"},i.chdir=function(t){throw new Error(\"process.chdir is not supported\")},i.umask=function(){return 0}}])});","extractedComments":[]}