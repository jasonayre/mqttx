{"code":"!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"/var/folders/2p/gpg4ppl908s3565b98n_pj2m0000gn/T/_karma_webpack_/\",n(n.s=53)}({0:function(e,t,n){\"use strict\";n.r(t);var o={};n.r(o),n.d(o,\"sleep\",function(){return r}),n.d(o,\"waitUntilCondition\",function(){return s});var i=n(26);function r(e){return new Promise(t=>setTimeout(t,e))}function a({max_attempts:e=5,resolve:t,reject:n,interval:o,condition:i,onInterval:s,returnValue:u=(()=>!0)}){!function(e=1e3,t=(()=>{})){r(e).then(()=>{t()})}(o,()=>{i()?t(u()):(s(),--e<1&&n(\"max_attempts_threshold_reached\"),a({condition:i,interval:o,onInterval:s,resolve:t,returnValue:u}))})}function s({condition:e=(()=>!0),interval:t=100,max_attempts:n=5,onInterval:o=(()=>{}),returnValue:i=(()=>!0)}={}){return new Promise((r,s)=>{a({resolve:r,condition:e,interval:t,max_attempts:n,onInterval:o,returnValue:i,reject:s})})}n.d(t,\"MQTTX\",function(){return i.MQTTX}),n.d(t,\"Helpers\",function(){return o})},26:function(e,t){throw new Error(\"Module parse failed: Unexpected token (28:62)\\nYou may need an appropriate loader to handle this file type.\\n|   }\\n| \\n>   static publish(topic, data, {as_json=true, qos=1, ...options={}) {\\n|     if(as_json) {\\n|       this.client.publish(topic, JSON.stringify(data), {qos, ...options});\")},53:function(e,t,n){\"use strict\";n.r(t);var o=n(0);n(0);const{sleep:i}=o.Helpers;o.MQTTX.connect(\"wss://test.mosquitto.org:8081\"),describe(\"MQTTX\",function(){let e;beforeAll(async()=>{await i(500)}),describe(\"connect\",function(){it(\"proxies over to mqtt\",async function(){let t;e={one:\"two\"},o.MQTTX.on(\"mqttx/some/fake/topic/one\",(e,n)=>{t=e}),await i(300),o.MQTTX.client.publish(\"mqttx/some/fake/topic/one\",JSON.stringify(e)),await i(300),expect(t).toEqual(e)})}),describe(\"multiple_topics\",function(){it(\"handles callbacks individually\",async function(){let t,n;e={one:\"two\"},o.MQTTX.on(\"mqttx/multiple_topics/fake/topic/one\",(e,n)=>{t=e}),o.MQTTX.on(\"mqttx/multiple_topics/fake/topic/two\",(e,t)=>{n=e}),await i(300),o.MQTTX.client.publish(\"mqttx/multiple_topics/fake/topic/one\",JSON.stringify(e)),await i(300),expect(t).toEqual(e),expect(n).toEqual(void 0)})}),describe(\"one_time_subscription\",function(){it(\"disposes after called first time\",async function(){let t;e={one:\"two\"};let n=o.MQTTX.on(\"mqttx/one_time_subscription/fake/topic/one\",(e,n)=>{t=e},{is_one_time:!0});expect(n.is_one_time).toEqual(!0),expect(n.observable).not.toEqual(void 0),await i(300),o.MQTTX.client.publish(\"mqttx/one_time_subscription/fake/topic/one\",JSON.stringify(e)),await i(300),expect(t).toEqual(e),await i(300);o.MQTTX.client.publish(\"mqttx/one_time_subscription/fake/topic/one\",JSON.stringify({two:\"three\"})),expect(t).toEqual(e),expect(n.observable).toEqual(null)})}),describe(\"request and response\",function(){it(\"makes request/response\",async function(){let e=\"mqttx/user/123/events\",t={event_type:\"FakeResponse\"};o.MQTTX.respondsTo(e,e=>({id:e.id,...t}),{});await i(300);let n=await o.MQTTX.request(e,{id:13});await i(300),expect(n.id).toEqual(13),expect(n.event_type).toEqual(\"FakeResponse\")})})})}});","extractedComments":[]}