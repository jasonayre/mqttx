{"code":"!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define([],e):\"object\"==typeof exports?exports.mqttx=e():t.mqttx=e()}(this,function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"\",n(n.s=5)}([function(t,e){t.exports=require(\"lodash\")},function(t,e,n){\"use strict\";function i(t){return new Promise(e=>setTimeout(e,t))}function r({max_attempts:t=5,resolve:e,reject:n,interval:o,condition:s,onInterval:c,returnValue:u=(()=>!0)}){!function(t=1e3,e=(()=>{})){i(t).then(()=>{e()})}(o,()=>{s()?e(u()):(c(),--t<1&&n(\"max_attempts_threshold_reached\"),r({condition:s,interval:o,onInterval:c,resolve:e,returnValue:u}))})}function o({condition:t=(()=>!0),interval:e=100,max_attempts:n=5,onInterval:i=(()=>{}),returnValue:o=(()=>!0)}={}){return new Promise((s,c)=>{r({resolve:s,condition:t,interval:e,max_attempts:n,onInterval:i,returnValue:o,reject:c})})}n.r(e),n.d(e,\"sleep\",function(){return i}),n.d(e,\"waitUntilCondition\",function(){return o})},function(t,e){t.exports=require(\"mqtt\")},function(t,e,n){\"use strict\";(function(t){n.d(e,\"a\",function(){return u});var i=n(0),r=n(2),o=n.n(r),s=n(4),c=n(1);void 0!==t&&\"node\"===Object(i.get)(t,\"release.name\")&&(n(2),console.log(\"after requiring mqtt\"));class u{static connect(...t){this.mqtt=o.a,this.client=o.a.connect(...t),this.subscription_manager=new s.a(this)}static on(t,e=(t=>{console.log(t)}),{qos:n=1,retain:i=!1,...r}={}){let o=this.subscription_manager.subscribe(t,e,{...r});return this.client.subscribe(t,e,{qos:n,...r}),o}static publish(t,e,{as_json:n=!0,qos:i=1,...r}={}){this.client.publish(t,JSON.stringify(e),{qos:i,...r})}static async request(t,e={},{publish_params:n={},qos:i=1,retain:r=!1,interval:o=50,max_attempts:s=5,is_one_time:u=!0,...a}={}){let l,p=`${t}/response`,f=`${t}/request`;let h=this.on(p,t=>l=t,{qos:i,retain:r,is_one_time:u,...a});return this.publish(f,e,{...n}),await Object(c.waitUntilCondition)({condition:()=>h.is_disposed,returnValue:()=>l})}static async respondsTo(t,e=(()=>{}),{publish_params:n={},qos:i=1,retain:r=!1,interval:o=50,max_attempts:s=5,...c}={}){let u=`${t}/response`,a=`${t}/request`;return this.on(a,t=>{let i=e(t);this.publish(u,i,n)},{qos:i,retain:r,...c})}static clear(){this.subscription_manager.clear()}}}).call(this,n(6))},function(t,e,n){\"use strict\";var i=n(0);class r{constructor({perform:t,topic:e,is_one_time:n=!1,observable:r,onBeforeDispose:o=[]}={}){Object(i.assign)(this,{_perform:t,topic:e,is_one_time:n,observable:r,is_disposed:!1,_onBeforeDisposeCallbacks:o})}matchesTopic(t){return e=t,n=this.topic,e===n;var e,n}perform(t,e,n){var i;console.log(\"checking if matches topic\",e),this.matchesTopic(e)&&(this._perform((i=t,JSON.parse(i.toString())),e,n,this),this.is_one_time&&this.dispose())}dispose(){Object(i.some)(this._onBeforeDisposeCallbacks)&&Object(i.invokeMap)(this._onBeforeDisposeCallbacks,\"call\"),this.observable&&(this.observable.unsubscribe(this),this.observable=null),this.is_disposed=!0}}n.d(e,\"a\",function(){return o});class o{constructor(t){this.subscriptions=[],this.mqttx=t,this._initializeMainSubscription()}_initializeMainSubscription(){this.mqttx.client.on(\"message\",(t,e,n)=>{this.notifySubscriptions(e,t,n)})}subscribe(t,e=(()=>{}),{is_one_time:n=!1,onBeforeDispose:i}={}){let o=new r({perform:e,topic:t,is_one_time:n,observable:this,onBeforeDispose:i});return this.subscriptions.push(o),o}unsubscribe(t){this.mqttx.client.unsubscribe(t.topic),this.subscriptions=this.subscriptions.filter(e=>e!==t)}notifySubscriptions(t,e,n){let r=[...this.subscriptions];Object(i.invokeMap)(r,\"perform\",t,e,n)}clear(){let t=[...this.subscriptions];Object(i.invokeMap)(t,\"dispose\")}}},function(t,e,n){\"use strict\";n.r(e);var i=n(3);n.d(e,\"MQTTX\",function(){return i.a});var r=n(1);n.d(e,\"Helpers\",function(){return r})},function(t,e){var n,i,r=t.exports={};function o(){throw new Error(\"setTimeout has not been defined\")}function s(){throw new Error(\"clearTimeout has not been defined\")}function c(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n=\"function\"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i=\"function\"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var u,a=[],l=!1,p=-1;function f(){l&&u&&(l=!1,u.length?a=u.concat(a):p=-1,a.length&&h())}function h(){if(!l){var t=c(f);l=!0;for(var e=a.length;e;){for(u=a,a=[];++p<e;)u&&u[p].run();p=-1,e=a.length}u=null,l=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function m(t,e){this.fun=t,this.array=e}function b(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];a.push(new m(t,e)),1!==a.length||l||c(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},r.title=\"browser\",r.browser=!0,r.env={},r.argv=[],r.version=\"\",r.versions={},r.on=b,r.addListener=b,r.once=b,r.off=b,r.removeListener=b,r.removeAllListeners=b,r.emit=b,r.prependListener=b,r.prependOnceListener=b,r.listeners=function(t){return[]},r.binding=function(t){throw new Error(\"process.binding is not supported\")},r.cwd=function(){return\"/\"},r.chdir=function(t){throw new Error(\"process.chdir is not supported\")},r.umask=function(){return 0}}])});","extractedComments":[]}